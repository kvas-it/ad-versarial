# Running the model as a web service

## Installation

The script in `prepare.sh` creates a virtualenv with Python 3.5, installs the
prerequisites in it and downloads and unpacks the ad-versarial dataset and the
model (if you have the .tgz files from
https://github.com/ftramer/ad-versarial/releases/download/0.1 already, put them
into `tmp/` directory here and they will be used instead of downloading).

After the installation the virtualenv will be in `venv` and it needs to be
activated (`source venv/bin/activate`) in order to run the model.

## Running the model in service mode

I have added an additional script for running the model as a web service. It's
located in [page-based/serve.py](page-based/serve.py). At the moment it always
runs on port 8080.

The service can process GET requests to `/` -- the response is an HTML form
that allows uploading of images and submitting them for ad detection). It also
can accept POST requests to `/detect` (see the form generated by `/` for
details on how to submit the image) -- the response is a JSON document that
contains the detected ads. It looks like this:

    {
      "size": [
        1919,
        1013
      ],
      "detection_time": 2.370616575004533,
      "boxes": [
        [
          1270.2652297386755,
          712.5061026353102,
          1628.7676589672383,
          950.3185680095966,
          0.9866073131561279
        ],
        [
          697.9126815795898,
          580.0566168931814,
          1250.8494065358088,
          652.573220032912,
          0.9866073131561279
        ]
      ]
    }

There's a convenience shell script: [serve.sh](serve.sh) that activates the
virtualenv and runs `serve.py`.
